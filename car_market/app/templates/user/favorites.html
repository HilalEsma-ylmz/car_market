{% extends 'base.html' %}

{% block title %}Favorilerim - CarHub{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0"><i class="bi bi-heart-fill me-2"></i>Favorilerim</h2>
</div>

{% if favorites and favorites.items|length %}
<div class="row g-4">
  {% for fav in favorites.items %}
  <div class="col-md-6 col-lg-4">
    <div class="card border-0 shadow-sm h-100 rounded-4">
      <div class="ratio ratio-16x9 bg-light rounded-top-4">
        {% if fav.listing and fav.listing.images %}
          {% set primary = (fav.listing.images|selectattr('is_primary')|list)[0] if fav.listing.images|length else None %}
          {% set first_img = fav.listing.images[0] if fav.listing.images|length else None %}
          <img src="{{ url_for('main.uploaded_file', filename='car_images/' ~ (primary.filename if primary else first_img.filename)) }}" class="w-100 h-100 object-fit-cover rounded-top-4" alt="{{ fav.listing.title if fav.listing }}">
        {% else %}
          <img src="{{ url_for('static', filename='images/placeholder_car.jpg') }}" class="w-100 h-100 object-fit-cover rounded-top-4" alt="{{ fav.listing.title if fav.listing }}">
        {% endif %}
      </div>
      <div class="card-body">
        <h6 class="mb-1">{{ fav.listing.title if fav.listing }}</h6>
        <div class="text-muted small mb-2">{{ fav.listing.brand if fav.listing }} • {{ fav.listing.model if fav.listing }}</div>
        <div class="d-flex justify-content-between align-items-center">
          <span class="fw-bold text-success">{{ '%.0f'|format(fav.listing.price) if fav.listing and fav.listing.price is not none }} ₺</span>
          <a href="{{ url_for('listings.listing_detail', listing_id=fav.listing_id) }}" class="btn btn-outline-gradient btn-sm">Görüntüle</a>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% if favorites.pages > 1 %}
<nav class="mt-4">
  <ul class="pagination justify-content-center">
    <li class="page-item {% if not favorites.has_prev %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('user.favorites', page=favorites.prev_num) }}">Önceki</a>
    </li>
    {% for p in favorites.iter_pages() %}
      {% if p %}
      <li class="page-item {% if p == favorites.page %}active{% endif %}"><a class="page-link" href="{{ url_for('user.favorites', page=p) }}">{{ p }}</a></li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">…</span></li>
      {% endif %}
    {% endfor %}
    <li class="page-item {% if not favorites.has_next %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('user.favorites', page=favorites.next_num) }}">Sonraki</a>
    </li>
  </ul>
  </nav>
{% endif %}
{% else %}
<div class="alert alert-info">Henüz favori eklemediniz.</div>
{% endif %}
{% endblock %}

